// Struct tests
uses: bootstrap.test

Person :: struct {
    name str
    age int
}

Point :: struct {
    x int
    y int
}

Person :: greet(self) str {
    return "Hello, {self.name}"
}

Person :: is_adult(self) bool {
    return self.age >= 18
}

Person :: birthday(self) {
    self.age += 1
}

Point :: distance_from_origin(self) int {
    return self.x * self.x + self.y * self.y
}

Point :: move_by(self, int dx, int dy) {
    self.x += dx
    self.y += dy
}

fn main {
    t := new_test()

    // Struct creation
    Person alice = Person { name: "Alice", age: 30 }
    t.assert_eq_str("Alice", alice.name)
    t.assert_eq_int(30, alice.age)

    // Field access
    Point p = Point { x: 3, y: 4 }
    t.assert_eq_int(3, p.x)
    t.assert_eq_int(4, p.y)

    // Method returning value
    t.assert_eq_str("Hello, Alice", alice.greet())

    // Method returning bool
    t.assert_true(alice.is_adult())

    Person child = Person { name: "Bob", age: 10 }
    t.assert_false(child.is_adult())

    // Method with calculation
    t.assert_eq_int(25, p.distance_from_origin())

    // Mutating methods
    child.birthday()
    t.assert_eq_int(11, child.age)

    p.move_by(1, 2)
    t.assert_eq_int(4, p.x)
    t.assert_eq_int(6, p.y)

    // Field modification
    alice.age = 31
    t.assert_eq_int(31, alice.age)

    // Multiple instances
    Person carol = Person { name: "Carol", age: 25 }
    t.assert_eq_str("Carol", carol.name)
    t.assert_eq_int(25, carol.age)

    t.summary()
}
